<!DOCTYPE html>
<html>
<head>
  <title>Login - UPSC Hindi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>Login to UPSC Hindi</h2>

<button id="googleBtn">Continue with Google</button>

<hr>

<input id="email" placeholder="Email"><br>
<input id="password" type="password" placeholder="Password"><br>
<button id="emailLogin">Login / Signup</button>

<p><a href="#" id="forgot">Forgot Password?</a></p>

<hr>

<input id="phone" placeholder="Mobile Number"><br>
<div id="recaptcha-container"></div>
<button id="sendOtp">Send OTP</button><br><br>

<input id="otp" placeholder="Enter OTP"><br>
<button id="verifyOtp">Verify OTP</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth,
  GoogleAuthProvider,
  signInWithPopup,
  signInWithEmailAndPassword,
  createUserWithEmailAndPassword,
  sendPasswordResetEmail,
  RecaptchaVerifier,
  signInWithPhoneNumber,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCYfVQx4WU3QZj-fya7bjQ8N0RPlKtEu6E",
    authDomain: "upsc-hindi-2007.firebaseapp.com",
    projectId: "upsc-hindi-2007",
    storageBucket: "upsc-hindi-2007.firebasestorage.app",
    messagingSenderId: "423661409014",
    appId: "1:423661409014:web:0b4b929ae22a23ea7bd2d7",
    measurementId: "G-H0RYV23BM5"
  };

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// âœ… If already logged in, go to home
onAuthStateChanged(auth, (user) => {
  if (user) window.location.href = "/index.html";
});

// Google login
document.getElementById("googleBtn").onclick = async () => {
  const provider = new GoogleAuthProvider();
  await signInWithPopup(auth, provider);
  window.location.href = "/index.html";
};

// Email login/signup
document.getElementById("emailLogin").onclick = async () => {
  const email = email.value;
  const password = password.value;
  try {
    await signInWithEmailAndPassword(auth, email, password);
  } catch {
    await createUserWithEmailAndPassword(auth, email, password);
  }
  window.location.href = "/index.html";
};

// Forgot password
document.getElementById("forgot").onclick = async () => {
  const e = email.value;
  if (!e) return alert("Enter email first");
  await sendPasswordResetEmail(auth, e);
  alert("Reset link sent");
};

// Phone OTP
window.recaptchaVerifier = new RecaptchaVerifier(auth, "recaptcha-container", { size: "normal" });

document.getElementById("sendOtp").onclick = async () => {
  const phone = "+91" + document.getElementById("phone").value;
  window.confirmationResult = await signInWithPhoneNumber(auth, phone, window.recaptchaVerifier);
  alert("OTP sent");
};

document.getElementById("verifyOtp").onclick = async () => {
  const code = document.getElementById("otp").value;
  await window.confirmationResult.confirm(code);
  window.location.href = "/index.html";
};
</script>

</body>
</html>
