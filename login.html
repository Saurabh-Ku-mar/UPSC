<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Login | Device Based Authentication</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Login Modal */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .login-container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 420px;
            overflow: hidden;
            animation: slideUp 0.4s ease-out;
        }
        
        .login-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .login-header h2 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .login-header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .login-body {
            padding: 30px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            color: #764ba2;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background: #764ba2;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            font-size: 14px;
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }
        
        .input-with-icon input {
            width: 100%;
            padding: 14px 14px 14px 45px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-with-icon input:focus {
            border-color: #764ba2;
            outline: none;
            box-shadow: 0 0 0 3px rgba(118, 75, 162, 0.1);
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(118, 75, 162, 0.3);
        }
        
        .btn-google {
            background: white;
            color: #444;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-google:hover {
            background: #f8f9fa;
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.1);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: #888;
            font-size: 14px;
        }
        
        .divider::before, .divider::after {
            content: "";
            position: absolute;
            top: 50%;
            width: 45%;
            height: 1px;
            background-color: #e0e0e0;
        }
        
        .divider::before {
            left: 0;
        }
        
        .divider::after {
            right: 0;
        }
        
        .forgot-link {
            text-align: center;
            margin-top: 20px;
        }
        
        .forgot-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
        }
        
        .forgot-link a:hover {
            text-decoration: underline;
        }
        
        .otp-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }
        
        .otp-section.active {
            display: block;
        }
        
        .otp-inputs {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        
        .otp-input {
            width: 45px;
            height: 45px;
            text-align: center;
            font-size: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        
        .otp-input:focus {
            border-color: #764ba2;
            outline: none;
        }
        
        .resend-otp {
            text-align: center;
            font-size: 14px;
            color: #666;
        }
        
        .resend-otp a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }
        
        .resend-otp a:hover {
            text-decoration: underline;
        }
        
        .hidden {
            display: none !important;
        }
        
        .website-content {
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
            display: none;
        }
        
        .website-content.active {
            display: block;
        }
        
        .content-header {
            text-align: center;
            margin-bottom: 50px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }
        
        .content-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        }
        
        .content-card i {
            font-size: 40px;
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .logout-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);
        }
        
        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }
        
        .error {
            background-color: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }
        
        .success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .login-container {
                max-width: 100%;
            }
            
            .login-body {
                padding: 20px;
            }
            
            .otp-input {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .website-content {
                padding: 20px;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-container">
            <div class="login-header">
                <h2>Welcome Back</h2>
                <p>Login required to access website content</p>
            </div>
            
            <div class="login-body">
                <!-- Messages -->
                <div class="message error" id="errorMessage"></div>
                <div class="message success" id="successMessage"></div>
                
                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" data-tab="phone">üì± Mobile</button>
                    <button class="tab" data-tab="email">üìß Email</button>
                    <button class="tab" data-tab="google">üîê Google</button>
                </div>
                
                <!-- Phone Tab -->
                <div class="tab-content active" id="phone-tab">
                    <div class="form-group">
                        <label>Mobile Number (with country code)</label>
                        <div class="input-with-icon">
                            <i class="fas fa-phone"></i>
                            <input type="tel" id="phone" placeholder="+1 234 567 8900" value="+1">
                        </div>
                    </div>
                    
                    <div class="form-group" id="password-section">
                        <label>Password</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="phone-password" placeholder="Enter password">
                        </div>
                    </div>
                    
                    <div class="otp-section" id="phone-otp-section">
                        <p style="margin-bottom: 15px; color: #666;">Enter the 6-digit OTP sent to your phone</p>
                        <div class="otp-inputs">
                            <input type="text" class="otp-input" maxlength="1" data-index="0">
                            <input type="text" class="otp-input" maxlength="1" data-index="1">
                            <input type="text" class="otp-input" maxlength="1" data-index="2">
                            <input type="text" class="otp-input" maxlength="1" data-index="3">
                            <input type="text" class="otp-input" maxlength="1" data-index="4">
                            <input type="text" class="otp-input" maxlength="1" data-index="5">
                        </div>
                        <div class="resend-otp">
                            Didn't receive code? <a id="resend-phone-otp">Resend OTP</a>
                        </div>
                    </div>
                    
                    <button class="btn" id="phone-login-btn">Login with Password</button>
                    <button class="btn" id="phone-otp-btn" style="background: #28a745;">Login with OTP</button>
                </div>
                
                <!-- Email Tab -->
                <div class="tab-content" id="email-tab">
                    <div class="form-group">
                        <label>Email Address</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="email" placeholder="your@email.com">
                        </div>
                    </div>
                    
                    <div class="form-group" id="email-password-section">
                        <label>Password</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="email-password" placeholder="Enter password">
                        </div>
                    </div>
                    
                    <div class="otp-section" id="email-otp-section">
                        <p style="margin-bottom: 15px; color: #666;">Enter the 6-digit OTP sent to your email</p>
                        <div class="otp-inputs">
                            <input type="text" class="otp-input" maxlength="1" data-index="0">
                            <input type="text" class="otp-input" maxlength="1" data-index="1">
                            <input type="text" class="otp-input" maxlength="1" data-index="2">
                            <input type="text" class="otp-input" maxlength="1" data-index="3">
                            <input type="text" class="otp-input" maxlength="1" data-index="4">
                            <input type="text" class="otp-input" maxlength="1" data-index="5">
                        </div>
                        <div class="resend-otp">
                            Didn't receive code? <a id="resend-email-otp">Resend OTP</a>
                        </div>
                    </div>
                    
                    <button class="btn" id="email-login-btn">Login with Password</button>
                    <button class="btn" id="email-otp-btn" style="background: #28a745;">Login with OTP</button>
                </div>
                
                <!-- Google Tab -->
                <div class="tab-content" id="google-tab">
                    <p style="text-align: center; margin-bottom: 25px; color: #666;">Sign in with Google account</p>
                    
                    <button class="btn btn-google" id="google-login-btn">
                        <i class="fab fa-google"></i> Continue with Google
                    </button>
                    
                    <div class="divider">OR</div>
                    
                    <div class="form-group">
                        <label>Enter Email for Passwordless Login</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="google-email" placeholder="your@email.com">
                        </div>
                    </div>
                    
                    <button class="btn" id="google-email-btn">Send Magic Link</button>
                </div>
                
                <!-- Forgot Password -->
                <div class="forgot-link">
                    <a id="forgot-password-link">Forgot Password?</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Forgot Password Modal -->
    <div class="login-modal hidden" id="forgotPasswordModal">
        <div class="login-container">
            <div class="login-header">
                <h2>Reset Password</h2>
                <p>We'll send a reset link to your email</p>
            </div>
            
            <div class="login-body">
                <div class="message error" id="resetErrorMessage"></div>
                <div class="message success" id="resetSuccessMessage"></div>
                
                <div class="form-group">
                    <label>Your Email Address</label>
                    <div class="input-with-icon">
                        <i class="fas fa-envelope"></i>
                        <input type="email" id="reset-email" placeholder="your@email.com">
                    </div>
                </div>
                
                <button class="btn" id="reset-submit-btn">Send Reset Email</button>
                <button class="btn" id="back-to-login" style="background: #6c757d;">Back to Login</button>
            </div>
        </div>
    </div>
    
    <!-- Website Content -->
    <div class="website-content" id="websiteContent">
        <div class="content-header">
            <h1>Welcome to Secure Website</h1>
            <p>You have successfully logged in. This content is protected.</p>
            <p id="userInfo" style="margin-top: 10px; color: #667eea; font-weight: 600;"></p>
        </div>
        
        <div class="content-grid">
            <div class="content-card">
                <i class="fas fa-shield-alt"></i>
                <h3>Secure Dashboard</h3>
                <p>Your personal dashboard with security features and privacy controls.</p>
            </div>
            
            <div class="content-card">
                <i class="fas fa-chart-line"></i>
                <h3>Analytics</h3>
                <p>View detailed analytics and reports about your activity.</p>
            </div>
            
            <div class="content-card">
                <i class="fas fa-cog"></i>
                <h3>Settings</h3>
                <p>Manage account settings, preferences, and security options.</p>
            </div>
        </div>
    </div>
    
    <!-- Logout Button -->
    <button class="logout-btn hidden" id="logoutBtn">Logout</button>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    
        <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCYfVQx4WU3QZj-fya7bjQ8N0RPlKtEu6E",
    authDomain: "upsc-hindi-2007.firebaseapp.com",
    projectId: "upsc-hindi-2007",
    storageBucket: "upsc-hindi-2007.firebasestorage.app",
    messagingSenderId: "423661409014",
    appId: "1:423661409014:web:86a505a272e4b9d97bd2d7",
    measurementId: "G-GG6ZLWYP2H"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
        </script>
        
        <script>
        // DOM Elements
        const loginModal = document.getElementById('loginModal');
        const forgotPasswordModal = document.getElementById('forgotPasswordModal');
        const websiteContent = document.getElementById('websiteContent');
        const logoutBtn = document.getElementById('logoutBtn');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const resetErrorMessage = document.getElementById('resetErrorMessage');
        const resetSuccessMessage = document.getElementById('resetSuccessMessage');
        
        // Login State
        const DEVICE_STORAGE_KEY = 'website_auth_data';
        let confirmationResult = null;
        let currentPhoneNumber = '';
        
        // Initialize
        init();
        
        function init() {
            setupEventListeners();
            checkAuthState();
        }
        
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                    hideMessages();
                });
            });
            
            // OTP Input handling
            document.querySelectorAll('.otp-input').forEach(input => {
                input.addEventListener('input', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    if (e.target.value && index < 5) {
                        const nextInput = document.querySelector(`.otp-input[data-index="${index + 1}"]`);
                        if (nextInput) nextInput.focus();
                    }
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !e.target.value) {
                        const index = parseInt(e.target.dataset.index);
                        if (index > 0) {
                            const prevInput = document.querySelector(`.otp-input[data-index="${index - 1}"]`);
                            if (prevInput) prevInput.focus();
                        }
                    }
                });
            });
            
            // Phone Login - Password
            document.getElementById('phone-login-btn').addEventListener('click', async () => {
                showError("Phone + Password requires backend setup. Use OTP instead.");
            });
            
            // Phone Login - OTP
            document.getElementById('phone-otp-btn').addEventListener('click', sendPhoneOTP);
            
            // Email Login - Password
            document.getElementById('email-login-btn').addEventListener('click', loginWithEmailPassword);
            
            // Email Login - OTP
            document.getElementById('email-otp-btn').addEventListener('click', () => {
                showError("Email OTP requires email link setup. Use password instead.");
            });
            
            // Google Login
            document.getElementById('google-login-btn').addEventListener('click', loginWithGoogle);
            
            // Google Email
            document.getElementById('google-email-btn').addEventListener('click', sendEmailLink);
            
            // Forgot Password
            document.getElementById('forgot-password-link').addEventListener('click', showForgotPassword);
            document.getElementById('reset-submit-btn').addEventListener('click', resetPassword);
            document.getElementById('back-to-login').addEventListener('click', () => {
                forgotPasswordModal.classList.add('hidden');
                loginModal.classList.remove('hidden');
                hideMessages();
            });
            
            // Logout
            logoutBtn.addEventListener('click', logout);
            
            // Resend OTP
            document.getElementById('resend-phone-otp').addEventListener('click', sendPhoneOTP);
            document.getElementById('resend-email-otp').addEventListener('click', () => {
                showError("Resend feature requires email link setup.");
            });
        }
        
        // Check authentication state
        function checkAuthState() {
            const savedAuth = localStorage.getItem(DEVICE_STORAGE_KEY);
            if (savedAuth) {
                try {
                    const { uid, timestamp } = JSON.parse(savedAuth);
                    const daysSinceLogin = (Date.now() - timestamp) / (1000 * 60 * 60 * 24);
                    
                    if (daysSinceLogin < 30) {
                        // Check Firebase auth state
                        auth.onAuthStateChanged((user) => {
                            if (user && user.uid === uid) {
                                showWebsiteContent(user);
                            } else {
                                showLoginModal();
                            }
                        });
                        return;
                    }
                } catch (e) {
                    console.error("Error parsing saved auth:", e);
                }
            }
            
            showLoginModal();
        }
        
        // Show login modal
        function showLoginModal() {
            loginModal.classList.remove('hidden');
            websiteContent.classList.remove('active');
            logoutBtn.classList.add('hidden');
        }
        
        // Show website content
        function showWebsiteContent(user) {
            loginModal.classList.add('hidden');
            forgotPasswordModal.classList.add('hidden');
            websiteContent.classList.add('active');
            logoutBtn.classList.remove('hidden');
            
            // Display user info
            const userInfo = document.getElementById('userInfo');
            if (user.email) {
                userInfo.textContent = `Logged in as: ${user.email}`;
            } else if (user.phoneNumber) {
                userInfo.textContent = `Logged in with: ${user.phoneNumber}`;
            }
            
            // Save to device
            localStorage.setItem(DEVICE_STORAGE_KEY, JSON.stringify({
                uid: user.uid,
                email: user.email || '',
                phone: user.phoneNumber || '',
                timestamp: Date.now()
            }));
        }
        
        // Send Phone OTP
        async function sendPhoneOTP() {
            const phone = document.getElementById('phone').value.trim();
            if (!phone || phone.length < 10) {
                showError("Please enter a valid phone number with country code (+1 for US)");
                return;
            }
            
            try {
                showLoading(document.getElementById('phone-otp-btn'), "Sending OTP...");
                
                // Firebase phone auth requires recaptcha
                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('phone-otp-btn', {
                    'size': 'invisible',
                    'callback': () => {
                        console.log("reCAPTCHA solved");
                    }
                });
                
                const verifier = window.recaptchaVerifier;
                confirmationResult = await auth.signInWithPhoneNumber(phone, verifier);
                currentPhoneNumber = phone;
                
                // Show OTP section
                document.getElementById('phone-otp-section').classList.add('active');
                document.getElementById('phone-login-btn').textContent = 'Verify OTP';
                document.getElementById('phone-login-btn').onclick = verifyPhoneOTP;
                
                showSuccess("OTP sent to your phone!");
                stopLoading(document.getElementById('phone-otp-btn'), "Login with OTP");
            } catch (error) {
                console.error("OTP Error:", error);
                showError("Failed to send OTP: " + error.message);
                stopLoading(document.getElementById('phone-otp-btn'), "Login with OTP");
                
                // If recaptcha error, try without it for demo
                if (error.code === 'auth/argument-error') {
                    showError("reCAPTCHA setup needed. Try email login instead.");
                }
            }
        }
        
        // Verify Phone OTP
        async function verifyPhoneOTP() {
            const otp = Array.from(document.querySelectorAll('#phone-otp-section .otp-input'))
                .map(input => input.value)
                .join('');
            
            if (otp.length !== 6) {
                showError("Please enter 6-digit OTP");
                return;
            }
            
            try {
                showLoading(document.getElementById('phone-login-btn'), "Verifying...");
                const result = await confirmationResult.confirm(otp);
                showWebsiteContent(result.user);
                showSuccess("Login successful!");
            } catch (error) {
                showError("Invalid OTP. Please try again.");
                stopLoading(document.getElementById('phone-login-btn'), "Verify OTP");
            }
        }
        
        // Email/Password Login
        async function loginWithEmailPassword() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('email-password').value;
            
            if (!validateEmail(email)) {
                showError("Please enter valid email");
                return;
            }
            
            if (!password) {
                showError("Please enter password");
                return;
            }
            
            try {
                showLoading(document.getElementById('email-login-btn'), "Logging in...");
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                showWebsiteContent(userCredential.user);
                showSuccess("Login successful!");
            } catch (error) {
                if (error.code === 'auth/user-not-found') {
                    // Try to create account
                    try {
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        showWebsiteContent(userCredential.user);
                        showSuccess("Account created and logged in!");
                    } catch (createError) {
                        showError("Failed to create account: " + createError.message);
                    }
                } else {
                    showError("Login failed: " + error.message);
                }
                stopLoading(document.getElementById('email-login-btn'), "Login with Password");
            }
        }
        
        // Google Login
        async function loginWithGoogle() {
            try {
                showLoading(document.getElementById('google-login-btn'), "Connecting...");
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                
                const result = await auth.signInWithPopup(provider);
                showWebsiteContent(result.user);
                showSuccess("Google login successful!");
            } catch (error) {
                console.error("Google Auth Error:", error);
                showError("Google login failed: " + error.message);
                stopLoading(document.getElementById('google-login-btn'), "Continue with Google");
            }
        }
        
        // Send Email Link
        async function sendEmailLink() {
            const email = document.getElementById('google-email').value.trim();
            if (!validateEmail(email)) {
                showError("Please enter valid email");
                return;
            }
            
            try {
                showLoading(document.getElementById('google-email-btn'), "Sending link...");
                
                const actionCodeSettings = {
                    url: window.location.href,
                    handleCodeInApp: true
                };
                
                await auth.sendSignInLinkToEmail(email, actionCodeSettings);
                localStorage.setItem('emailForSignIn', email);
                showSuccess("Magic link sent! Check your email.");
                stopLoading(document.getElementById('google-email-btn'), "Send Magic Link");
            } catch (error) {
                showError("Failed to send link: " + error.message);
                stopLoading(document.getElementById('google-email-btn'), "Send Magic Link");
            }
        }
        
        // Handle Email Link
        if (auth.isSignInWithEmailLink(window.location.href)) {
            let email = localStorage.getItem('emailForSignIn');
            if (!email) {
                email = prompt('Please provide your email for confirmation');
            }
            
            if (email) {
                auth.signInWithEmailLink(email, window.location.href)
                    .then((result) => {
                        localStorage.removeItem('emailForSignIn');
                        showWebsiteContent(result.user);
                        showSuccess("Email link login successful!");
                        window.history.replaceState({}, document.title, window.location.pathname);
                    })
                    .catch((error) => {
                        showError("Email link error: " + error.message);
                    });
            }
        }
        
        // Reset Password
        async function resetPassword() {
            const email = document.getElementById('reset-email').value.trim();
            if (!validateEmail(email)) {
                showResetError("Please enter valid email");
                return;
            }
            
            try {
                showLoading(document.getElementById('reset-submit-btn'), "Sending...");
                await auth.sendPasswordResetEmail(email);
                showResetSuccess("Password reset email sent! Check your inbox.");
                stopLoading(document.getElementById('reset-submit-btn'), "Send Reset Email");
                
                setTimeout(() => {
                    forgotPasswordModal.classList.add('hidden');
                    loginModal.classList.remove('hidden');
                    hideMessages();
                }, 3000);
            } catch (error) {
                showResetError("Failed to send reset email: " + error.message);
                stopLoading(document.getElementById('reset-submit-btn'), "Send Reset Email");
            }
        }
        
        // Logout
        async function logout() {
            try {
                await auth.signOut();
                localStorage.removeItem(DEVICE_STORAGE_KEY);
                showLoginModal();
                showSuccess("Logged out successfully!");
                resetForms();
            } catch (error) {
                showError("Logout error: " + error.message);
            }
        }
        
        // Show Forgot Password Modal
        function showForgotPassword() {
            loginModal.classList.add('hidden');
            forgotPasswordModal.classList.remove('hidden');
            hideMessages();
        }
        
        // Helper Functions
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
        }
        
        function showSuccess(message) {
            successMessage.textContent = message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
        }
        
        function showResetError(message) {
            resetErrorMessage.textContent = message;
            resetErrorMessage.style.display = 'block';
            resetSuccessMessage.style.display = 'none';
        }
        
        function showResetSuccess(message) {
            resetSuccessMessage.textContent = message;
            resetSuccessMessage.style.display = 'block';
            resetErrorMessage.style.display = 'none';
        }
        
        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            resetErrorMessage.style.display = 'none';
            resetSuccessMessage.style.display = 'none';
        }
        
        function showLoading(button, text) {
            button.innerHTML = `<span class="loading"></span>${text}`;
            button.disabled = true;
        }
        
        function stopLoading(button, originalText) {
            button.innerHTML = originalText;
            button.disabled = false;
        }
        
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function resetForms() {
            document.querySelectorAll('input').forEach(input => {
                if (input.type !== 'submit' && input.type !== 'button') {
                    input.value = '';
                }
            });
            
            document.querySelectorAll('.otp-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('phone-login-btn').textContent = 'Login with Password';
            document.getElementById('phone-login-btn').onclick = () => {
                showError("Phone + Password requires backend setup.");
            };
        }
    </script>
</body>
</html>